---
title: 回调函数
date: 2018-10-11 15:00:54
categories: JavaScript
---

A callback is a function that is passed as an argument to another function and is executed after its parent function has completed。

<!-- more --> 

# 什么是回调函数

## 定义一

```
A callback is a function that is passed as an argument to another function and is executed after its parent function has completed。
```

回调函数就是一个参数，将这个函数作为参数传到另一个函数里面，当那个函数执行完之后，再执行传进去的这个函数。这个过程就叫做回调。 

## 定义二

当程序跑起来时，一般情况下，应用程序（application program）会时常通过API调用库里所预先备好的函数。但是有些库函数（library function）却要求应用先传给它一个函数，好在合适的时候调用，以完成目标任务。这个被传入的、后又被调用的函数就称为回调函数（callback function）。

通常将一个函数B传入另一个函数A，并且在需要的时候再调用函数A。

说白了，回调就是回溯，先定义好将要使用的函数体，然后在使用使再调用这个函数，我们通常把callback作为一个参数传入先定义的那个函数。下面我们先来看一段jquery代码：

```js
$("p").hide(1000,function(){
alert("The paragraph is now hidden");
});
```

上面jquery就是一个回调函数，首先它在执行完hide效果后，接着调用function回调函数。

我们再来看一段JS代码，看看回调函数是如何实现的：

```js
function Buy(name,goods1,callback) {
    alert(name+' buy '+goods1);
    if(callback&&typeof(callback)==="function")
        callback();
}
Buy('xiaoming','apple',function(){
    alert("shopping finish");
});
```

# 闭包与回调

下面看一道闭包的题目，分别点击第一个和第四个节点，执行结果：

```js
var nodes = document.getElementsByTagName('button');
for (var i = 0; i < nodes.length; i++) {
    nodes[i].addEventListener('click', function() {
        console.log('You clicked element #' + i);
   });
}
```

这里虽然主要考的是闭包，addEventListener是一个闭包，而匿名函数是一个回调函数，i是在闭包中的变量。在addEventListener的回调执行时，循环已经结束，此时的变量i被赋值为node.length，node.length为总节点数。所以结果就是

```js
You clicked element # node.length
```

那要怎么改，将其返回值改成函数，既然i变量的值会被释放，那我们就引入i，让每次循环的值都保存在内存中，就可以了：

```js
var nodes = document.getElementsByTagName('button');
for (var i = 0; i < nodes.length; i++) {
(function(i) {
    nodes[i].addEventListener('click', function () {
        console.log('You clicked element #' + i);
        })
    })(i);
}
```

参考https://blog.csdn.net/jingege0318/article/details/62447345