---
title: 日常-2020.7.23
date: 2020-07-23 09:52:01
categories: 日常
---

* onShareAppMessage(Object object)
* 打开小程序分享链接时触发函数顺序
* getStorage和getStorgeSync
* V-on的修饰符
* getqueryStorage：封装好的获取参数的函数
* url编码与解码
* 再次熟悉git上传流程

<!--more-->

## onShareAppMessage(Object object)

监听用户点击页面内转发按钮（[button](https://developers.weixin.qq.com/miniprogram/dev/component/button.html) 组件 `open-type="share"`）或右上角菜单“转发”按钮的行为，并自定义转发内容。 

| 参数   | 类型   | 说明                                                         | 最低版本                                                     |
| ------ | ------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| from   | String | 转发事件来源。 `button`：页面内转发按钮； `menu`：右上角转发菜单 | [1.2.4](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| target | Object | 如果 `from` 值是 `button`，则 `target` 是触发这次转发事件的 `button`，否则为 `undefined` | [1.2.4](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |

target为button时，有以下参数

```
dataset:{}
id:""
offsetLeft:
offsetTop:
```

此事件处理函数需要 return 一个 Object，用于自定义转发内容，返回内容如下：

**自定义转发内容** 基础库 [2.8.1](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) 起，分享图支持云图片。

| 字段     | 说明                                                         | 默认值                                    | 最低版本 |
| -------- | ------------------------------------------------------------ | ----------------------------------------- | -------- |
| title    | 转发标题                                                     | 当前小程序名称                            |          |
| path     | 转发路径                                                     | 当前页面 path ，必须是以 / 开头的完整路径 |          |
| imageUrl | 自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径。支持PNG及JPG。显示图片长宽比是 5:4。 | 使用默认截图                              | 1.5.0    |

```js
//封装好的函数
	onShareAppMessage(res) {
        if (res.from === 'button') {
            let data = res.target.dataset.data
            let params = '?fromShare=1&'
            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    params += `${key}=${data[key]}&`
                }
            }
            params = params.substring(0, params.length - 1)
            console.log(`【分享参数】：${res.target.dataset.path}${params}`)
            return {
                title: res.target.dataset.title || '',
                path: `${res.target.dataset.path}${params}` || '',
                imageUrl: res.target.dataset.url || ''
            }
        }
    }
```

## 打开小程序分享链接时触发函数顺序

* 首先会触发`APP.vue中的onShow函数`
* 然后会触发打开页面的`onLoad与onShow页面`

## getStorage和getStorgeSync

**1.缓存介绍：**

*每个微信小程序都可以有自己的本地缓存，可以通过 wx.setStorage（wx.setStorageSync）、wx.getStorage（wx.getStorageSync）、wx.clearStorage（wx.clearStorageSync）可以对本地缓存进行设置、获取和清理。同一个微信用户，同一个小程序 storage 上限为 10MB。localStorage 以用户维度隔离，同一台设备上，A 用户无法读取到 B 用户的数据。*

**2. wx.getStorage和wx.getStorageSync的区别：**

wx.setStorage(object)是一个异步接口，参数object包含key和data（需要存储的内容），他有3个回调函数：success（接口调用成功的回调函数）、fail（接口调用失败的回调函数）、complete（接口调用结束的回调函数，调用成功、失败都会执行）。我们可以通过3个回调函数进一步优化一功能。

wx.setStorageSync(key，data)是一个同步接口，需要接受key和data（String/Object）2个参数，他没有上述三个回调函数。

## V-on的修饰符

- `.stop` - 调用 `event.stopPropagation()`。
- `.prevent` - 调用 `event.preventDefault()`。
- `.capture` - 添加事件侦听器时使用 capture 模式。
- `.self` - 只当事件是从侦听器绑定的元素本身触发时才触发回调。
- `.{keyCode | keyAlias}` - 只当事件是从特定键触发时才触发回调。
- `.native` - 监听组件根元素的原生事件。
- `.once` - 只触发一次回调。
- `.left` - (2.2.0) 只当点击鼠标左键时触发。
- `.right` - (2.2.0) 只当点击鼠标右键时触发。
- `.middle` - (2.2.0) 只当点击鼠标中键时触发。
- `.passive` - (2.3.0) 以 `{ passive: true }` 模式添加侦听器

## getqueryStorage：封装好的获取参数的函数

```js
        getQuery() {   //获取当前页面的参数
            const routerHistory = getCurrentPages();
            return routerHistory[routerHistory.length - 1].options;
        },
        getQueryStorage(key) {   //根据key值来获取对应的参数值
            const query = this.getQuery();
            if (query && (query[key] || query[key] == '0')) {
                return query[key];
            }
            return RootStore.getters.queryStorage[key];
        }
```

## url编码与解码

网页URL只能使用英文、数字、还有一些特定的字符，若出现中文字符就必须经过编码解码，否则服务器无法识别

编码方法有三种：

| 方法                                                 | 规则                                                         | 特点                                                         |
| ---------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| escape（编码） unescape                              | 除了ASCII字母、数字、标点符号"@ * _ + - . /"以外，对其他所有字符进行编码 | 不提倡                                                       |
| encodeURI（编码） decodeURI（解码）                  | 除了常见的符号以外，对其他一些在网址中有特殊含义的符号"; / ? : @ & = + $ , #"，也不进行编码 | encodeURI()是Javascript中真正用来对URL编码的函数，它着眼于对整个URL进行编码 |
| encodeURIComponent（编码）  decodeURIComponent解码） | 在encodeURI()中不被编码的符号"; / ? : @ & = + $ , #"，在encodeURIComponent()中统统会被编码 | 与encodeURI()的区别是，它用于对URL的组成部分进行个别编码，而不用于对整个URL进行编码 |

## 再次熟悉git上传流程

* git status -sb   显示当前所有文件的状态
* git add .
* git commit -m 'xxxx'
* git push

在git merge master时，由于本地库的代码跟远程库有冲突，会显示以下界面，提示你输入合并的必要性

![1](http://quanzhan.applemei.com/ueditor/php/upload/image/20190124/1548296413834552.jpeg)

只需要输入`:wq`退出即可