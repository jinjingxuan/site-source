---
title: 日常-2020.3.27
date: 2020-03-27 09:52:01
categories: 日常
---

* 手写一下myNew
* 数据属性与访问器属性

<!--more-->

## 1.myNew

简述new一个对象的过程：

> 创造一个新的空对象
> 新对象的\_proto_指向构造函数的原型对象
> 构造函数的this指向正在创建的新对象，并执行构造函数的代码，向新对象中添加属性和方法。
> 返回新对象地址

```js
		function book(name,value){
            this.name = name
            this.value = value
        }

        let book1 = new book("abc","100")
        console.log(book1)

        function myNew(constructor,...args){
            let obj = new Object()
            constructor.call(obj,...args)
            obj.__proto__ = constructor.prototype
            return obj
        }
        let book2 = myNew(book,"def","200")
        console.log(book2)

        console.log(book2 instanceof book) //true
```

## 2. 数据属性与访问器属性

首先明确，这两个概念是针对数据来定义的。

#### 数据属性

数据属性（property）用于实现JavaScript引擎，是属性(property)的内部值，它包含一个数据值的位置。有如下4种行为特性。

* [[Configurable]]：能否被delete删除属性重新定义
* [[Enumerable]]：能否被for-in枚举
* [[Writable]]：能否修改属性值
* [[Value]]：数据的数据值

```js
let person = {}
Object.defineProperty(person,"name",{
    writable:false   //不可修改属性
    value:"abc"
})

console.log(person.name) //abc
person.name = bcd
console.log(person.name) //abc
```

#### 访问器属性

访问器属性主要由setter和getter函数组成，包含如下4个特性：

* [[Configurable]]：能否被delete删除属性重新定义。默认值：true
* [[Enumerable]]：能否被for-in枚举。默认值：true
* [[Get]]：读取属性值。默认值：undefined
* [[Set]]：写入属性值。默认值：undefined

```js
let book = {
    _year:2004, //_year前面的下划线是一种常用的记号，用于表示只能通过对象方法访问的属性。
    edition:1
}
Object.defineProperty(book,"year",{
    get:function(){
        return this._year
    },
    set:function(newValue){
    	if(newValue>2004){
    		this._year = newValue
    		this.edition += newValue-2004
		}
	}
})

book.year = 2005
console.log(book.edition)
```

其实_year和year是两个属性，\_year是数据属性，year是访问器属性，\_year为内部使用的，year为外部使用的。

如果都改为year，调用book.year会报错，因为这句话既可以输出数据属性，也可以调用访问器属性，产生冲突。

