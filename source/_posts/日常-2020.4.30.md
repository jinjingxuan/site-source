---
title: 日常-2020.4.30
date: 2020-04-30 09:52:01
categories: 日常
---

# 今日清单

* mpvue绑定图片src属性时的问题
* vue的异步请求放在哪个钩子函数中合适，mpvue呢

<!--more-->

## mpvue绑定图片src属性时的问题

绑定图片的src属性时，一般是这样的，路径直接写src中的static文件夹下的图片就行：

```html
<img src="路径" alt="">
```

想要动态绑定属性时，是这样的：

```html
<img :src="imgPath" alt="">

<script>
data () {
    return {
		imgPath:"路径"
    }
}
</script>
```

在mpvue里，最终生成的是dist目录，所以在动态绑定时，需要将图片路径设置为dist目录下的static文件夹

## vue的异步请求放在哪个钩子函数中合适

首先复习一下vue的生命周期

```
beforeCreate（创建前）: 在数据观测和初始化事件还未开始,data、watcher、methods都还不存在，但是$route已存在，可以根据路由信息进行重定向等操作。

created(创建后)：在实例创建之后被调用，该阶段可以访问data，使用watcher、events、methods，也就是说 数据观测(data observer) 和event/watcher 事件配置 已完成。但是此时dom还没有被挂载。该阶段允许执行http请求操作。

beforeMount （挂载前）：将HTML解析生成AST节点，再根据AST节点动态生成渲染函数。相关render函数首次被调用(划重点)。

mounted (挂载后)：在挂载完成之后被调用，执行render函数生成虚拟dom，创建真实dom替换虚拟dom，并挂载到实例。可以操作dom，比如事件监听

beforeUpdate：vm.data更新之后，虚拟dom重新渲染之前被调用。在这个钩子可以修改vm.data更新之后，虚拟dom重新渲染之前被调用。在这个钩子可以修改vm.data更新之后，虚拟dom重新渲染之前被调用。在这个钩子可以修改vm.data，并不会触发附加的冲渲染过程。

updated：虚拟dom重新渲染后调用，若再次修改$vm.data，会再次触发beforeUpdate、updated，进入死循环。

beforeDestroy：实例被销毁前调用，也就是说在这个阶段还是可以调用实例的。

destroyed：实例被销毁后调用，所有的事件监听器已被移除，子实例被销毁。
```

> 实际上在created，beforeMount，mounted都可以，因为此时data已经创建，后端传来的数据可以放入data中。

* created 阶段的优势是：请求时间比较早，页面 loading 时间相对较短； 

有人说如果需要操作dom需要放在mounted中，因为mounted完成了挂载，真实的DOM存在了。

但其实当生命周期遇到异步函数时，都会先执行完生命周期，再去执行异步函数。

```js
	var vm = new Vue({
            el: "#app",
            template: "<div>hello world</div>",
            beforeCreate: function() {
                console.log("beforeCreate")
            },
            created: function() {
                console.log("created")
                setTimeout(function(){
                  console.log(1)
                },0)
            },
            beforeMount: function() {
                console.log(this.$el)
                console.log("beforeMount")
            },
            mounted: function() {
                console.log("mounted")
                console.log(this.$el)
            }
        });

// beforeCreate
//created
//<div id='app'></div>
//beforeMount
//mounted
//<div>hello world</div>
//1
```

但是在mpvue中就不行了，因为mpvue的created会一次性执行完，这里用到原生小程序的onLoad。