---
title: 前端安全
date: 2020-12-018 09:21:01
categories: 前端安全
---

* XSS
* CSRF
* 点击劫持
* HTTP传输安全
* 第三方依赖安全
* 控制台注入代码
* 钓鱼
* 本地存储数据泄露

## XSS

> XSS指的是恶意攻击者往Web页面里插入恶意html代码，当用户浏览该页之时，嵌入其中Web里面的html代码会被执行，从而达到恶意攻击用户的特殊目的。简单举一个例子

```html
<div v-html="content"></div>

new Vue({
    el: '#app',
    data: {
        content: `<img src="xxx" onerror="alert(document.cookie)">`
		content: `<script>alert(document.cookie)</script>`
    }
})
```

> XSS的攻击一般分为以下几类：反射型XSS，存储型XSS，DOM XSS。
>
> 反射型和存储型在纯前端渲染中已经很少见了，尤其在第三方框架下

#### 反射型XSS

* 通过url攻击

```js
// node 服务端 app.js
const express = require('express')

const app = express()

app.get('/', (req, res) => {
    // 1. 读取渲染页面的内容
    // 2, 将渲染结果发送给客户端
    res.render('index.html', {
        search: req.query.search // 通过地址栏传递
    })
})

app.listen(3000, () => console.log('http://loalhost:3000/'))
```

```html
<!-- index.html -->

<form action="/" method="GET">
    <!-- 输入框内输入 <script>alert(document.cookie)</script> -->
	<input name="search" type="text">
    <button>搜索</button>
</form>

{{ if search }}
</div> 展示搜索内容 </div>	
{{ /if }}
```

#### 存储型XSS

* 攻击者将恶意代码提交到目标网站的数据库中
* 用户打开目标网站时，服务端将恶意代码从数据库中取出，拼接在html中返回给浏览器
* 用户浏览器接收响应解析时，取出恶意代码执行

> 比如一个富文本编辑器，产生的结果：html格式的字符串，web后台存储到数据库中
>
> 当其他用户查看文章详情时，就会渲染文章内容，将恶意代码执行

#### DOM型XSS

* 攻击者构造出特殊的 URL，包含恶意代码
* 用户打开带有恶意代码的 URL
* 用户浏览器接收到响应后，javascript 取出 URL 恶意代码执行

> DOM 型和前两种的区别：DOM 型 XSS中，取出和执行恶意代码由浏览器端完成，其他两种都属于服务端安全漏洞

### XSS 攻击注入点

* HTML中内嵌文本，恶意代码以 script 标签注入
* 标签的 href, src 等属性中，包含 javascript 等可执行代码
* 在 onload, onerror, onclick 等事件中
* style 属性和标签中，包含 background-image: url("javascript")
* style 属性和标签中，包含 expression(...) 的 CSS 表达式代码

### XSS 防御

XSS 攻击有两大要素：

* 攻击者提交恶意代码
* 浏览器执行恶意代码

常见解决办法：

* 纯前端渲染，将代码和数据分隔开
  * 浏览器先加载一个静态HTML，此HTML不包含任何跟业务相关数据
  * 然后浏览器执行 HTML 中的 Javascript
  * Javascript 通过 Ajax加载业务数据，调用 DOM API 更新到页面上
* 对 HTML 做充分转义
  * & < > " ' /'
  * 转义库 js-xss
* CSP：内容安全策略
* X-Xss-Protection

## CSRF

* [跨站请求伪造—CSRF](https://juejin.cn/post/6844904004288249870)
* [CSRF图示](https://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg)