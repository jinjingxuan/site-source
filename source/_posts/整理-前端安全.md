---
title: 前端安全
date: 2020-12-18 09:21:01
categories: 前端安全
---

* XSS
* CSRF
* 点击劫持
* HTTP传输安全
* 第三方依赖安全
* 控制台注入代码
* 钓鱼
* 本地存储数据泄露

## XSS

> XSS指的是恶意攻击者往Web页面里插入恶意html代码，当用户浏览该页之时，嵌入其中Web里面的html代码会被执行，从而达到恶意攻击用户的特殊目的。简单举一个例子

```html
<div v-html="content"></div>

<script>
new Vue({
    el: '#app',
    data: {
				// src 不存在从而触发 onerror
        content: `<img src="xxx" onerror="alert(document.cookie)">`
				content: `<script>alert(document.cookie)</script>`
    }
})
</script>
```

### XSS危害

* 窃取 cookie
* 按键记录和钓鱼
* 未授权操作
* 获取页面数据
* 劫持前端逻辑
* 偷取用户资料
* ...

> XSS的攻击一般分为以下几类：反射型XSS，存储型XSS，DOM XSS。
>
> 反射型和存储型在纯前端渲染中已经很少见了，尤其在第三方框架下

#### 反射型XSS

* 攻击者构造出特殊的 url，其中包含恶意代码
* 用户打开带有恶意代码的 url 时，网站服务端将恶意代码从 url 中取出，拼接在 html 中返回给浏览器
* 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行
* 恶意代码窃取用户数据并发送到攻击者的网站，或冒充用户的行为，调用目标网站接口执行攻击者指定操作

```js
// node 服务端 app.js
const express = require('express')

const app = express()

app.get('/', (req, res) => {
    // 1. 读取渲染页面的内容
    // 2, 将渲染结果发送给客户端
    res.render('index.html', {
        search: req.query.search // 通过地址栏传递
    })
})

app.listen(3000, () => console.log('http://loalhost:3000/'))
```

```html
<!-- index.html -->

<form action="/" method="GET">
    <!-- 输入框内输入 <script>alert(document.cookie)</script> -->
	<input name="search" type="text">
    <button>搜索</button>
</form>

{{ if search }}
</div> 展示搜索内容 </div>	
{{ /if }}
```

#### 存储型XSS

* 攻击者将恶意代码提交到目标网站的数据库中
* 用户打开目标网站时，服务端将恶意代码从数据库中取出，拼接在html中返回给浏览器
* 用户浏览器接收响应解析时，取出恶意代码执行
* 这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。

> 比如一个富文本编辑器，产生的结果：html格式的字符串，web后台存储到数据库中
>
> 当其他用户查看文章详情时，就会渲染文章内容，将恶意代码执行

#### DOM型XSS

> DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。
>
> 在使用 `.innerHTML`、`.outerHTML`、`document.write()` 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 `.textContent`、`.setAttribute()` 等。
>
> 如果用 Vue/React 技术栈，并且不使用 `v-html`/`dangerouslySetInnerHTML` 功能，就在前端 render 阶段避免 `innerHTML`、`outerHTML` 的 XSS 隐患。
>
> DOM 中的内联事件监听器，如 `location`、`onclick`、`onerror`、`onload`、`onmouseover` 等，`<a>` 标签的 `href` 属性，JavaScript 的 `eval()`、`setTimeout()`、`setInterval()` 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。
>
> DOM 型和前两种的区别：DOM 型 XSS中，取出和执行恶意代码由浏览器端完成，其他两种都属于服务端安全漏洞

### XSS 攻击注入点

* HTML中内嵌文本，恶意代码以 script 标签注入
* 标签的 href, src 等属性中，包含 javascript 等可执行代码
* 在 onload, onerror, onclick 等事件中
* style 属性和标签中，包含 background-image: url("javascript")
* style 属性和标签中，包含 expression(...) 的 CSS 表达式代码

### XSS 防御

XSS 攻击有两大要素：

* 攻击者提交恶意代码
* 浏览器执行恶意代码

常见解决办法：

* 纯前端渲染，将代码和数据分隔开
  * 浏览器先加载一个静态HTML，此HTML不包含任何跟业务相关数据
  * 然后浏览器执行 HTML 中的 Javascript
  * Javascript 通过 Ajax加载业务数据，调用 DOM API 更新到页面上
* 对 HTML 做充分转义
  * & < > " ' /'
  * 转义库 js-xss
* CSP：内容安全策略
* X-Xss-Protection

## CSRF

* [跨站请求伪造—CSRF](https://juejin.cn/post/6844904004288249870)
* [CSRF图示](https://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg)